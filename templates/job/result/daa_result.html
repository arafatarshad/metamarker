
{% extends "dashboard_main_template/dashboard_main.html" %}
{% load staticfiles %}

{% block content %}


<style media="screen">
  body {
  font-family: 'Open Sans', sans-serif;
  font-weight: 300;
}
.tabs {
  /* max-width: 640px;
   */
   /* min-height: 500px;
    */

    /* height:500px; */
  margin: 0 auto;
  padding: 0 20px;
  max-height:800px;
}
#tab-button {
  display: table;
  table-layout: fixed;
  width: 100%;
  margin: 0;
  padding: 0;
  list-style: none;
}
#tab-button li {
  display: table-cell;
  width: 20%;
}
#tab-button li a {
  display: block;
  padding: .5em;
  background: #eee;
  border: 1px solid #ddd;
  text-align: center;
  color: #000;
  text-decoration: none;
}
#tab-button li:not(:first-child) a {
  border-left: none;
}
#tab-button li a:hover,
#tab-button .is-active a {
  border-bottom-color: transparent;
  background: #fff;
}
.tab-contents {
  padding: .5em 2em 1em;
  border: 1px solid #ddd;
  /* height:100% */
}



.tab-button-outer {
  display: none;
}
.tab-contents {
  margin-top: 20px;
}
@media screen and (min-width: 768px) {
  .tab-button-outer {
    position: relative;
    z-index: 2;
    display: block;
  }
  .tab-select-outer {
    display: none;
  }
  .tab-contents {
    position: relative;
    top: -1px;
    margin-top: 0;
  }



  .node {
    stroke: #fff;
    stroke-width: 1.5px;
  }

  .link {
    fill: none;
    stroke: #bbb;
  }
</style>




<div class="box box-default">
  <div class="box-header with-border">
    <h3 class="box-title">A glimpse of the uploaded dataset</h3>
    <div class="box-tools pull-right">
      <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i></button>
    </div>
  </div>
  <div class="box-body">

      <svg width="1960" height="600"></svg>

  </div>
</div>















<div class="box box-default">
  <div class="box-header with-border">
    <h3 class="box-title">A glimpse of the uploaded dataset</h3>
    <div class="box-tools pull-right">
      <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i></button>
    </div>
  </div>
  <div class="box-body">


    <div class=" table-container" style="width:auto;overflow:auto;margin-top:30px">

          <div class="tabs">
           <div class="tab-button-outer">
             <ul id="tab-button">
               <li><a href="#tab01">Tab 1</a></li>
               <li><a href="#tab02">Tab 2</a></li>
               <li><a href="#tab03">Tab 3</a></li>
             </ul>
           </div>
           <div class="tab-select-outer">
             <select id="tab-select">
               <option value="#tab01">Tab 1</option>
               <option value="#tab02">Tab 2</option>
               <option value="#tab03">Tab 3</option>

             </select>
           </div>

           <div id="tab01" class="tab-contents">

             <h2>Tab 1</h2>
             <div class=" table-container" style="width:auto;overflow:auto;margin-top:30px">
               {% if table %}
                 <div >
                 {{ table|safe }}
                 </div>
               {% endif %}
             </div>
           </div>
           <div id="tab02" class="tab-contents">
             <h2>Tab 2</h2>
             {% if table1 %}
               <div >
               {{ table1|safe }}
               </div>
             {% endif %}

              </div>
           <div id="tab03" class="tab-contents">
             <h2>Tab 3</h2>
             {% if table2 %}
               <div >
               {{ table2|safe }}
               </div>
             {% endif %}

              </div>

          </div>
    </div>

  </div>
</div>



{% endblock%}

{%block scripts %}

<script type="text/javascript">
  let margin = {top: 30, right: 10, bottom: 10, left: 0};

 $(function() {
   var $tabButtonItem = $('#tab-button li'),
       $tabSelect = $('#tab-select'),
       $tabContents = $('.tab-contents'),
       activeClass = 'is-active';

   $tabButtonItem.first().addClass(activeClass);
   $tabContents.not(':first').hide();

   $tabButtonItem.find('a').on('click', function(e) {
     var target = $(this).attr('href');

     $tabButtonItem.removeClass(activeClass);
     $(this).parent().addClass(activeClass);
     $tabSelect.val(target);
     $tabContents.hide();
     $(target).show();
     e.preventDefault();
   });

   $tabSelect.on('change', function() {
     var target = $(this).val(),
         targetSelectNum = $(this).prop('selectedIndex');

     $tabButtonItem.removeClass(activeClass);
     $tabButtonItem.eq(targetSelectNum).addClass(activeClass);
     $tabContents.hide();
     $(target).show();
   });
 });




































 function getRandomInt(max) {
   return Math.floor(Math.random() * Math.floor(max));
 }

var nodes=[]
var links=[]



 var svg = d3.select("svg"),
     width = +svg.attr("width"),
     height = +svg.attr("height");
 var color = d3.scaleOrdinal(d3.schemeCategory20);
 var simulation = d3.forceSimulation()
     .force("link", d3.forceLink().id(function(d) { return d.id; }))
     .force("charge", d3.forceManyBody())
     .force("center", d3.forceCenter(width / 2, height / 2));


d3.json("{% url 'api_get_sig_cor' 123 %}".replace('123',"{{ job }}"), function(error, data) {
  if (error) throw error;
   const dimensions=Object.keys(data)


  dimensions.forEach(function(element){
    nodes.push({"id":element,"group":getRandomInt(21)})
    var stack=data[element]
    dimensions.forEach(function(again_element){
      if (element != again_element && stack[again_element]==1)
        // console.log(element+"--------------->"+again_element+"========="+);
        links.push({"source":element,"target":again_element,"value":stack[again_element]})
    });

  })//dimensions for each


    var nodeById = d3.map(nodes, function(d) { return d.id; }),
        bilinks = [];

    links.forEach(function(link) {
      var s = link.source = nodeById.get(link.source),
          t = link.target = nodeById.get(link.target),
          i = {}; // intermediate node
      nodes.push(i);
      links.push({source: s, target: i}, {source: i, target: t});
      bilinks.push([s, i, t]);
    });

    var link = svg.selectAll(".link")
      .data(bilinks)
      .enter().append("path")
        .attr("class", "link");

    var node = svg.selectAll(".node")
      .data(nodes.filter(function(d) { return d.id; }))
      .enter().append("circle")
        .attr("class", "node")
        .attr("r", 5)
        .attr("fill", function(d) { return color(d.group); })
        .call(d3.drag()
            .on("start", dragstarted)
            .on("drag", dragged)
            .on("end", dragended));

    node.append("title")
        .text(function(d) { return d.id; });

    simulation
        .nodes(nodes)
        .on("tick", ticked);

    simulation.force("link")
        .links(links);

    function ticked() {
      link.attr("d", positionLink);
      node.attr("transform", positionNode);
    }















});//d3.json forEach


function positionLink(d) {
  return "M" + d[0].x + "," + d[0].y
       + "S" + d[1].x + "," + d[1].y
       + " " + d[2].x + "," + d[2].y;
}

function positionNode(d) {
  return "translate(" + d.x + "," + d.y + ")";
}

function dragstarted(d) {
  if (!d3.event.active) simulation.alphaTarget(0.3).restart();
  d.fx = d.x, d.fy = d.y;
}

function dragged(d) {
  d.fx = d3.event.x, d.fy = d3.event.y;
}

function dragended(d) {
  if (!d3.event.active) simulation.alphaTarget(0);
  d.fx = null, d.fy = null;
}

</script>

{% endblock%}
